{"data":[{"addr":"1LSKtFoK81PNxN4SEn2qErsa8V3PizUBCx","blk":{"i":613970,"t":1576874099},"conf":true,"fn":"--[[\nImplements the [Bitkey protocol](https://bitkey.network). Returns a state with\nthe Bitkey identity paymail and public key. Verifies both the Bitkey and paymail\nsignatures.\n\nThe Bitkey API stores both signatures base64 encoded and the pubkey hex encoded.\n\n## Examples\n\n    OP_FALSE OP_RETURN\n      $REF\n        \"H+g5cgN6ILgrtoxSpt25ogVkOMuC6irp8Il7e5SGVrrkC2xZMIdCNwt8TPjbIG9ZTBDrVQujT0CeRWINpXXTRHU=\"\n        \"H+OgWIxuPUV18+FFl1sXvEQ0lZ2OsYbWf385F3ZnBPSxBo4X/2K94xuSbWwDIuD8DS4O98RywgkAzgEOxRhN6+4=\"\n        \"644@moneybutton.com\"\n        \"02f6d2857cccf8cafe9c8fdb665bd710e3b8990c45857ccdefd75bbe24a20d4e62\"\n    # {\n    #   paymail: \"644@moneybutton.com\",\n    #   pubkey: <<binary pubkey>>,\n    #   verified: true\n    # }\n\n@version 0.1.1\n@author Libs\n]]--\nreturn function(state, bitkey_sig, paymail_sig, paymail, pubkey)\n  state = state or {}\n\n  -- Local helper method to determine if a string is blank\n  local function isblank(str)\n    return str == nil or str == ''\n  end\n\n  assert(\n    type(state) == 'table',\n    'Invalid state. Must receive a table.')\n  assert(\n    not (isblank(bitkey_sig) or isblank(paymail_sig)),\n    'Signatures must be present.')\n  assert(\n    not isblank(pubkey)\n    and string.len(pubkey) == 66\n    and string.match(pubkey, '^0[23][a-fA-F0-9]+$'),\n    'Invalid pubkey. Public key must be compressed and hex-encoded.')\n\n  -- Bitkey protocol address\n  local bitkey_addr = '13SrNDkVzY5bHBRKNu5iXTQ7K7VqTh5tJC'\n\n  state.paymail = paymail\n  state.pubkey = base.decode16(pubkey)\n\n  -- Verify both the bitkey and paymail signatures\n  local message = crypto.hash.sha256(paymail..pubkey, {encoding = 'hex'})\n  local v1 = crypto.bitcoin_message.verify(bitkey_sig, message, bitkey_addr)\n  local v2 = crypto.bitcoin_message.verify(paymail_sig, pubkey, state.pubkey)\n\n  state.verified = v1 and v2\n  return state\nend\n","hash":"a575f641d205a846a87b8ca43593beb1aef462895fd1875674682e6cd14639ec","i":2491,"meta":{"author":"Libs","version":"0.1.1"},"name":"bitcom/bitkey","ref":"a575f641","txid":"1019720d711492c8e99e07a4f6dd7fd85575e6f5ab50a63c374323c3bf57ce68"}]}